/*************************************************
 *File----------testFPU.c
 *Project-------Risc-V-FPGA
 *Author--------Justin Kachele
 *Created-------Monday Dec 22, 2025 20:58:05 UTC
 *License-------GNU GPL-3.0
 ************************************************/

#include "libs/printf.h"

// float fdiv(float f1, float f2) {
//         float ans;
//         asm(
//                         "fmv.w.x fa0, %1\n"
//                         "fmv.w.x fa1, %2\n"
//                         "fdiv.s fa0, fa0, fa1\n"
//                         "fmv.x.w %0, fa0\n"
//                         : "=r"(ans)
//                         : "r"(f1), "r"(f2)
//                         :);
//         return ans;
// }
//
// float fmul(float f1, float f2) {
//         float ans;
//         asm(
//                         "fmv.w.x fa0, %1\n"
//                         "fmv.w.x fa1, %2\n"
//                         "fmul.s fa0, fa0, fa1\n"
//                         "fmv.x.w %0, fa0\n"
//                         : "=r"(ans)
//                         : "r"(f1), "r"(f2)
//                         :);
//         return ans;
// }
//
// float fsub(float f1, float f2) {
//         float ans;
//         asm(
//                         "fmv.w.x fa0, %1\n"
//                         "fmv.w.x fa1, %2\n"
//                         "fsub.s fa0, fa0, fa1\n"
//                         "fmv.x.w %0, fa0\n"
//                         : "=r"(ans)
//                         : "r"(f1), "r"(f2)
//                         :);
//         return ans;
// }
//
// float fadd(float f1, float f2) {
//         float ans;
//         asm(
//                         "fmv.w.x fa0, %1\n"
//                         "fmv.w.x fa1, %2\n"
//                         "fadd.s fa0, fa0, fa1\n"
//                         "fmv.x.w %0, fa0\n"
//                         : "=r"(ans)
//                         : "r"(f1), "r"(f2)
//                         :);
//         return ans;
// }
//
// float fsqrt(float f) {
//         float ans;
//         asm(
//                         "fmv.w.x fa0, %1\n"
//                         "fsqrt.s fa0, fa0\n"
//                         "fmv.x.w %0, fa0\n"
//                         : "=r"(ans)
//                         : "r"(f)
//                         :);
//         return ans;
// }

static const float nums1[] = {
        37.3706479901,
        63.8516196837,
        41.3766783323,
        88.4347647022,
        21.3226546009,
        14.0097950069,
        45.9369366088,
        86.2644939890,
        38.2303796392,
        70.3434826441,
        12.0681064855,
        55.4300458353,
        55.3706467744,
        75.9114085971,
        75.3367860611,
        75.2231893311,
        82.7019638550,
        99.9134464778,
        13.5120261465,
        10.5224024693,
        90.1104093724,
        54.7297872899,
        61.9102425599,
        50.2240106861,
        19.1653019721,
        87.6116833262,
        77.2555302049,
        69.1614169643,
        70.6686076446,
        27.4493303465,
        42.4787054230,
        20.8168097845,
        28.4581207939,
        76.8850041758,
        76.0749146388,
        92.8852756681,
        73.2009001640,
        87.7894551814,
        33.1660434487,
        2.1729862865,
        93.6698867776,
        17.7034976329,
        91.7399455257,
        76.9508171389,
        90.2363992337,
        97.4901816149,
        45.7621468883,
        31.0260588171,
        43.7878146850,
        29.6822362832,
        31.8429667207,
        18.0670608335,
        54.1805735423,
        8.1645682078,
        71.0958541146,
        70.1494272175,
        95.6390773902,
        23.1430326860,
        79.7277347176,
        87.3815207757,
        30.0378757280,
        49.9042340932,
        88.0580167205,
        33.7303997127,
        36.8263798012,
        94.8116320445,
        27.0937791984,
        7.0238032249,
        20.1264354894,
        88.6905268716,
        31.8972336273,
        54.1830741795,
        39.7321083753,
        46.9348858399,
        32.7803173415,
        8.9428308863,
        29.9837050281,
        92.2759020821,
        65.4403328702,
        36.8272926014,
        72.7575582791,
        55.8799524986,
        79.9540443348,
        95.5154260946,
        76.3370157571,
        60.4714803977,
        52.7231063424,
        93.7079979905,
        33.5174117057,
        75.8384904657,
        17.5861855715,
        87.4685764776,
        28.9575305342,
        25.0006120366,
        87.0054824319,
        38.9338693431,
        6.5286981659,
        85.2873158989,
        66.8786158650,
        40.1725248426
};

static const float nums2[] =  {
        36.6375113031,
        39.3959311456,
        78.4895102637,
        29.0390026233,
        33.3073476036,
        27.8405004469,
        35.3555809485,
        90.3032839783,
        9.5912591607,
        81.5884145860,
        20.5125998859,
        46.5545399529,
        66.6540831241,
        62.6815187938,
        67.8532984810,
        70.9767640617,
        52.4673819722,
        19.8157345573,
        8.0290076368,
        20.6408716336,
        86.4418046131,
        67.0528460874,
        61.3392436465,
        24.6369525797,
        16.6921888983,
        48.7970568677,
        46.2826535713,
        19.8749115597,
        67.3883120977,
        26.5724441958,
        24.1871100947,
        6.7093331568,
        4.9777842340,
        49.3710037887,
        27.2884890377,
        63.8830920141,
        7.3143486900,
        42.3039711123,
        63.8624307299,
        90.7608747080,
        8.9081093196,
        57.4530875909,
        13.1097404485,
        82.5209186142,
        32.5475328189,
        46.8800398225,
        81.3253209086,
        22.2114193008,
        28.7446942695,
        39.8529626898,
        99.3567992033,
        50.4118336835,
        29.5329367049,
        20.1669943811,
        4.5453721394,
        73.3330309231,
        19.0099880100,
        73.0596046918,
        94.6038699353,
        27.1599901753,
        8.3895753593,
        61.6758318893,
        74.1564847287,
        47.0571003262,
        47.5136139496,
        10.3371595451,
        56.7053335365,
        69.4951779812,
        81.5987560384,
        30.0444386898,
        41.8619322744,
        66.2923713578,
        79.2865750021,
        51.8187526976,
        68.8705843137,
        51.4984386794,
        33.5775543801,
        34.3215263940,
        9.1852467847,
        47.9433709554,
        84.2028961148,
        79.7989315251,
        74.5946574278,
        60.4994202191,
        71.5987005686,
        39.7655906553,
        57.4868315627,
        53.9238760816,
        34.6359585685,
        43.8579049713,
        19.8602242146,
        47.7976372947,
        62.8405973407,
        87.2864022747,
        11.6504280189,
        4.8354058505,
        44.9163875224,
        51.0518230045,
        33.3291916086,
        46.0176135673
};

static const unsigned long ans[] = {
        0x3f828fb4,
        0x3fcf754a,
        0x3f06f415,
        0x4042e77c,
        0x3f23e2c1,
        0x3f00d2ca,
        0x3fa64eef,
        0x3f748cec,
        0x407f19fb,
        0x3f5cb77e,
        0x3f169c91,
        0x3f986723,
        0x3f54a9d6,
        0x3f9b042f,
        0x3f8e1df4,
        0x3f87a875,
        0x3fc9c2b8,
        0x40a1591a,
        0x3fd7694d,
        0x3f028142,
        0x3f856eae,
        0x3f50f3b5,
        0x3f813108,
        0x400277d6,
        0x3f92f6e8,
        0x3fe5d0a4,
        0x3fd5a8b8,
        0x405eb59e,
        0x3f863b11,
        0x3f843957,
        0x3fe0cced,
        0x4046920f,
        0x40b6f1e0,
        0x3fc7554d,
        0x40326b5b,
        0x3fba1c4b,
        0x41202026,
        0x4004d02d,
        0x3f04f330,
        0x3cc421c5,
        0x41283df3,
        0x3e9dc44e,
        0x40dfee5b,
        0x3f6eb85f,
        0x40316fd1,
        0x400517a0,
        0x3f100d6c,
        0x3fb2cc09,
        0x3fc2fca9,
        0x3f3eaacd,
        0x3ea41768,
        0x3eb77ecc,
        0x3fead38f,
        0x3ecf483e,
        0x417a4310,
        0x3f74e2e4,
        0x40a0fde0,
        0x3ea22f92,
        0x3f57beb1,
        0x404de80e,
        0x406524f7,
        0x3f4f23a5,
        0x3f97fec2,
        0x3f378006,
        0x3f466afe,
        0x4112c033,
        0x3ef4a222,
        0x3dcefd3a,
        0x3e7c9226,
        0x403ced36,
        0x3f430ffe,
        0x3f513cdd,
        0x3f00496b,
        0x3f67df4c,
        0x3ef3b251,
        0x3e31d1f4,
        0x3f64999a,
        0x402c1191,
        0x40e3fbf1,
        0x3f44a4ec,
        0x3f5d33fa,
        0x3f334433,
        0x3f893246,
        0x3fca158c,
        0x3f88788b,
        0x3fc2a641,
        0x3f6ac945,
        0x3fde6fad,
        0x3f77bb8d,
        0x3fdd55fb,
        0x3f62affd,
        0x3fea3caf,
        0x3eebef32,
        0x3e92a5b4,
        0x40eef9eb,
        0x4100d44c,
        0x3e14d739,
        0x3fd5d650,
        0x40006c43,
        0x3f5f7bb7
};

int main(int argc, char *argv[]) {
    // printf("Hello, World!\n");

    for (int i = 0; i < 100; i++) {
            float ansf = nums1[i] / nums2[i];
            unsigned long ansfBits = *(long*)&ansf;
            // printf("%f / %f = %f\n", nums1[i], nums2[i], ansf);
            if (ansfBits != ans[i]) {
                    float ansFloat = *(float*)&ans[i];
                    printf("ERROR: Mismatch at index %d: %0.12f != %0.12f\n", i, ansf, ansFloat);
            }
            // printf("%x\n", ansfBits);
    }

    return 0;
}

